---
name: efsbroker

templates:
  install.erb: bin/pre-start
  ctl.erb: bin/efsbroker_ctl
  db_ca.crt.erb: db_ca.crt
  services.json.erb: config/services.json

packages:
- efsbroker

properties:
  efsbroker.listen-addr:
    description: "address efsbroker listens on"
    default: "0.0.0.0:8999"
  efsbroker.service-name:
    description: "name of the service to be registered with cf"
    default: "efs"
  efsbroker.service-id:
    description: "Id of the service to be registered with cf"
    default: "efs-service-guid"
  efsbroker.data-dir:
    description: "Directory on broker VM to persist instance and binding state"
    default: "/var/vcap/store/efsbroker"
  efsbroker.db_driver:
    default: ""
    description: "(optional) database driver name when using SQL to store broker state"
  efsbroker.db_username:
    default: ""
    description: "(optional) database username when using SQL to store broker state"
  efsbroker.db_password:
    default: ""
    description: "(optional) database password when using SQL to store broker state"
  efsbroker.db_hostname:
    default: ""
    description: "(optional) database hostname when using SQL to store broker state"
  efsbroker.db_port:
    default: ""
    description: "(optional) database port when using SQL to store broker state"
  efsbroker.db_name:
    default: ""
    description: "(optional) database name when using SQL to store broker state"
  efsbroker.db_ca_cert:
    default: ""
    description: "(optional) CA Cert to verify database SSL connection. If not included connection will not be encrypted"
  efsbroker.username:
    description: "Basic auth username to verify on incoming Service Broker requests"
    default: "admin"
  efsbroker.password:
    description: "Basic auth password to verify on incoming Service Broker requests"
    default: "admin"
  efsbroker.aws-region:
    description: "AWS Region where the broker will create EFS instances"
    default: "us-east-1"
  efsbroker.aws-access-key-id:
    description: "AWS Access Key Id for the account managing EFS instances"
  efsbroker.aws-secret-access-key:
    description: "AWS Secret Access Key for the account managing EFS instances"
  efsbroker.aws-subnet-ids:
    description: "Comma-separated AWS subnet Ids where mount targets should be created"
  efsbroker.aws-security-groups:
    description: "Comma separated AWS security group ids to assign to the mount points (one per subnet)"
  efsbroker.aws-azs:
    description: "Comma separated AWS AZs of the subnets (one per subnet)"
  efsbroker.log_level:
    description: "efsbroker log level"
    default: "info"
  efsbroker.log_time_format:
    description: "Format for timestamp in component logs. Valid values are 'unix-epoch' and 'rfc3339'."
    default: "rfc3339"
  efsbroker.credhub.url:
    description: "url for credhub"
  efsbroker.credhub.ca:
    description: "credhub CA"
  efsbroker.credhub.clientid:
    description: "uaa clientid"
  efsbroker.credhub.clientsecret:
    description: "uaa client secret"
  efsbroker.uaa.ca:
    description: "uaa CA"
  efsbroker.services:
    description: "List of services and plans supported by broker"
    default:
    - id: "d0406c23-c33f-4f10-804b-9083a486d857"
      name: "efs"
      description: "Existing efs volumes (Deprecated)"
      bindable: true
      plan_updatable: false
      tags: ["efs"]
      requires: ["volume_mount"]
      metadata:
        display_name: "Legacy NFS V3 Volume Broker"
        image_url: data:image/png;base64,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
        long_description: "Legacy broker for existing NFSv3 volumes (deprecated)"
        provider_display_name: "Dell / Pivotal"
        documentation_url: https://docs.cloudfoundry.org/devguide/services/using-vol-services.html
      plans:
      - id: "09a09260-1df5-4445-9ed7-1ba56dadbbc8"
        name: "generalPurpose"
        description: "A preexisting filesystem"
        metadata:
          costs:
          - amount:
              usd: 0.0
            unit: "MONTHLY"
          display_name: "Existing Filesystems"